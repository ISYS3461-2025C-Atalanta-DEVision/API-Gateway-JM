# Render Deployment Profile for API Gateway
# This profile is activated when SPRING_PROFILES_ACTIVE=render
# Only contains OVERRIDES - base config is in application.yml

server:
  port: ${PORT:8080}  # Render sets PORT env variable

# CORS - Override for production
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000}

# Eureka - Override for Render deployment
eureka:
  client:
    enabled: ${EUREKA_ENABLED:true}
    service-url:
      defaultZone: ${EUREKA_URL:http://eureka:eureka-secret-2024@localhost:8761/eureka/}
    healthcheck:
      enabled: false  # Disable health check - Eureka can't reach HTTPS endpoint on Render
  instance:
    prefer-ip-address: false
    hostname: api-gateway-khhr.onrender.com
    instance-id: ${spring.application.name}:${RENDER_SERVICE_ID:${random.uuid}}
    non-secure-port-enabled: false
    secure-port-enabled: true
    secure-port: 443
    home-page-url: https://api-gateway-khhr.onrender.com/
    status-page-url: https://api-gateway-khhr.onrender.com/actuator/info
    health-check-url: https://api-gateway-khhr.onrender.com/actuator/health
    health-check-url-path: /actuator/health
    status-page-url-path: /actuator/info
    lease-renewal-interval-in-seconds: 30
    lease-expiration-duration-in-seconds: 90

# Secrets - No defaults in production (must be set in Render env vars)
internal:
  api-key: ${INTERNAL_API_KEY}

jwt:
  secret: ${JWT_SECRET}

# Production logging - less verbose
logging:
  level:
    root: WARN
    com.devision.jm.gateway: INFO
    org.springframework.cloud.gateway: WARN

# Actuator - more restrictive in production
management:
  endpoint:
    health:
      show-details: when_authorized
  health:
    eureka:
      enabled: false  # Don't let Eureka status affect health endpoint

# Circuit breaker - longer timeout for cloud
resilience4j:
  timelimiter:
    configs:
      default:
        timeoutDuration: 5s
